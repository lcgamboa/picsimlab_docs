<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PICSimLab - Programmable IC Simulator Laboratory: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="picsimlab.png"/></td>
  <td id="projectalign">
   <div id="projectname">PICSimLab - Programmable IC Simulator Laboratory<span id="projectnumber">&#160;0.9.0</span>
   </div>
   <div id="projectbrief">PICSimLab - API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p >This is the documentation to explain the use of picsimlab internal classes.</p>
<p >The main objective of this domentation is to enable the expansion of the simulator with the creation of new boards (<a class="el" href="classboard.html">board</a>) and parts (<a class="el" href="classpart.html">part</a>).</p>
<h1><a class="anchor" id="partex"></a>
Part example</h1>
<h2><a class="anchor" id="pinc"></a>
output_step.h</h2>
<div class="fragment"><div class="line"><span class="comment">/* ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   PICSimLab - Programmable IC Simulator Laboratory</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   Copyright (c) : 2010-2023  Luis Claudio Gambôa Lopes &lt;lcgamboa@yahoo.com&gt;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span></div>
<div class="line"><span class="comment">   any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">   along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   For e-mail suggestions :  lcgamboa@yahoo.com</span></div>
<div class="line"><span class="comment">   ######################################################################## */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef PART_STEP_H</span></div>
<div class="line"><span class="preprocessor">#define PART_STEP_H</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;lxrad.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/part.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define PART_STEP_Name &quot;Step Motor&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classcpart__step.html">cpart_step</a> : <span class="keyword">public</span> <a class="code hl_class" href="classpart.html">part</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    lxString <a class="code hl_function" href="classcpart__step.html#a6a7cf5e9cf0292d04509374717d2cccb">GetAboutInfo</a>(<span class="keywordtype">void</span>)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> lxT(<span class="stringliteral">&quot;L.C. Gamboa \n &lt;lcgamboa@yahoo.com&gt;&quot;</span>); };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="classcpart__step.html#adf52e27da153cb8c261a7366fcbce73b">cpart_step</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> x, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> y, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <span class="keywordtype">char</span>* type);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="classcpart__step.html#a91a0941165fa7531f44c7b74321533f3">~cpart_step</a>(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a406716b623a2635c48eefe7630a2d8c9">DrawOutput</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a19c45dc044f0d8484d775a5da8fa95ec">PreProcess</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a6892916acaf8198565079b952c61d846">Process</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#ae9c71fcf6de5804a5483d8e42c3edf57">PostProcess</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a6a5fbbfff34b78315a3f012f62a08431">ConfigurePropertiesWindow</a>(CPWindow* WProp) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a623a12a47674716ed3e71a840b0b7cb8">ReadPropertiesWindow</a>(CPWindow* WProp) <span class="keyword">override</span>;</div>
<div class="line">    lxString <a class="code hl_function" href="classcpart__step.html#a6226f0a8ad635fb166a37b52f3d8d912">WritePreferences</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#aae902fc383b486ab1b9d40b83aea65a3">ReadPreferences</a>(lxString value) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcpart__step.html#a55297faec243e7aab6a1cb9a21031bc7">GetInputId</a>(<span class="keywordtype">char</span>* name) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcpart__step.html#ab42f4bd7f3f11d659cdbe726323edc9a">GetOutputId</a>(<span class="keywordtype">char</span>* name) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a9023bfe76e703c10930a713591165743">RegisterRemoteControl</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[4];   </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[1];  </div>
<div class="line">    <span class="keywordtype">float</span> steps;</div>
<div class="line">    <span class="keywordtype">float</span> angle;</div>
<div class="line">    <span class="keywordtype">int</span> input[2];</div>
<div class="line">    <span class="keywordtype">int</span> turns;</div>
<div class="line">    lxColor color1;</div>
<div class="line">    lxColor color2;</div>
<div class="line">    lxFont font;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* PART_STEP */</span><span class="preprocessor"></span></div>
<div class="ttc" id="aclasscpart__step_html"><div class="ttname"><a href="classcpart__step.html">cpart_step</a></div><div class="ttdoc">step motor part class</div><div class="ttdef"><b>Definition:</b> output_step.h:39</div></div>
<div class="ttc" id="aclasscpart__step_html_a19c45dc044f0d8484d775a5da8fa95ec"><div class="ttname"><a href="classcpart__step.html#a19c45dc044f0d8484d775a5da8fa95ec">cpart_step::PreProcess</a></div><div class="ttdeci">void PreProcess(void) override</div><div class="ttdoc">Called every start of CPU process.</div><div class="ttdef"><b>Definition:</b> output_step.cc:151</div></div>
<div class="ttc" id="aclasscpart__step_html_a3da50407c2419060293a8a7d6da931fa"><div class="ttname"><a href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">cpart_step::input_pins</a></div><div class="ttdeci">unsigned char input_pins[4]</div><div class="ttdoc">pulse input pind</div><div class="ttdef"><b>Definition:</b> output_step.h:68</div></div>
<div class="ttc" id="aclasscpart__step_html_a406716b623a2635c48eefe7630a2d8c9"><div class="ttname"><a href="classcpart__step.html#a406716b623a2635c48eefe7630a2d8c9">cpart_step::DrawOutput</a></div><div class="ttdeci">void DrawOutput(const unsigned int index) override</div><div class="ttdoc">Called to draw every output.</div><div class="ttdef"><b>Definition:</b> output_step.cc:66</div></div>
<div class="ttc" id="aclasscpart__step_html_a55297faec243e7aab6a1cb9a21031bc7"><div class="ttname"><a href="classcpart__step.html#a55297faec243e7aab6a1cb9a21031bc7">cpart_step::GetInputId</a></div><div class="ttdeci">unsigned short GetInputId(char *name) override</div><div class="ttdoc">return the input ids numbers of names used in input map</div><div class="ttdef"><b>Definition:</b> output_step.cc:359</div></div>
<div class="ttc" id="aclasscpart__step_html_a6226f0a8ad635fb166a37b52f3d8d912"><div class="ttname"><a href="classcpart__step.html#a6226f0a8ad635fb166a37b52f3d8d912">cpart_step::WritePreferences</a></div><div class="ttdeci">lxString WritePreferences(void) override</div><div class="ttdoc">Called to save part preferences in configuration file.</div><div class="ttdef"><b>Definition:</b> output_step.cc:392</div></div>
<div class="ttc" id="aclasscpart__step_html_a623a12a47674716ed3e71a840b0b7cb8"><div class="ttname"><a href="classcpart__step.html#a623a12a47674716ed3e71a840b0b7cb8">cpart_step::ReadPropertiesWindow</a></div><div class="ttdeci">void ReadPropertiesWindow(CPWindow *WProp) override</div><div class="ttdoc">Called when properties window close.</div><div class="ttdef"><b>Definition:</b> output_step.cc:418</div></div>
<div class="ttc" id="aclasscpart__step_html_a6892916acaf8198565079b952c61d846"><div class="ttname"><a href="classcpart__step.html#a6892916acaf8198565079b952c61d846">cpart_step::Process</a></div><div class="ttdeci">void Process(void) override</div><div class="ttdoc">Called every CPU step.</div><div class="ttdef"><b>Definition:</b> output_step.cc:175</div></div>
<div class="ttc" id="aclasscpart__step_html_a6a5fbbfff34b78315a3f012f62a08431"><div class="ttname"><a href="classcpart__step.html#a6a5fbbfff34b78315a3f012f62a08431">cpart_step::ConfigurePropertiesWindow</a></div><div class="ttdeci">void ConfigurePropertiesWindow(CPWindow *WProp) override</div><div class="ttdoc">Called to configure the properties window.</div><div class="ttdef"><b>Definition:</b> output_step.cc:410</div></div>
<div class="ttc" id="aclasscpart__step_html_a6a7cf5e9cf0292d04509374717d2cccb"><div class="ttname"><a href="classcpart__step.html#a6a7cf5e9cf0292d04509374717d2cccb">cpart_step::GetAboutInfo</a></div><div class="ttdeci">lxString GetAboutInfo(void) override</div><div class="ttdoc">Return the about information of part.</div><div class="ttdef"><b>Definition:</b> output_step.h:41</div></div>
<div class="ttc" id="aclasscpart__step_html_a7ee6c2cbf8b8fcf3757b8a4d999d5903"><div class="ttname"><a href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">cpart_step::output_pins</a></div><div class="ttdeci">unsigned char output_pins[1]</div><div class="ttdoc">pulse output pin</div><div class="ttdef"><b>Definition:</b> output_step.h:69</div></div>
<div class="ttc" id="aclasscpart__step_html_a9023bfe76e703c10930a713591165743"><div class="ttname"><a href="classcpart__step.html#a9023bfe76e703c10930a713591165743">cpart_step::RegisterRemoteControl</a></div><div class="ttdeci">void RegisterRemoteControl(void) override</div><div class="ttdoc">Register remote control variables.</div><div class="ttdef"><b>Definition:</b> output_step.cc:406</div></div>
<div class="ttc" id="aclasscpart__step_html_a91a0941165fa7531f44c7b74321533f3"><div class="ttname"><a href="classcpart__step.html#a91a0941165fa7531f44c7b74321533f3">cpart_step::~cpart_step</a></div><div class="ttdeci">~cpart_step(void)</div><div class="ttdoc">destructor called once on part destruction</div><div class="ttdef"><b>Definition:</b> output_step.cc:61</div></div>
<div class="ttc" id="aclasscpart__step_html_aae902fc383b486ab1b9d40b83aea65a3"><div class="ttname"><a href="classcpart__step.html#aae902fc383b486ab1b9d40b83aea65a3">cpart_step::ReadPreferences</a></div><div class="ttdeci">void ReadPreferences(lxString value) override</div><div class="ttdoc">Called whe configuration file load preferences.</div><div class="ttdef"><b>Definition:</b> output_step.cc:401</div></div>
<div class="ttc" id="aclasscpart__step_html_ab42f4bd7f3f11d659cdbe726323edc9a"><div class="ttname"><a href="classcpart__step.html#ab42f4bd7f3f11d659cdbe726323edc9a">cpart_step::GetOutputId</a></div><div class="ttdeci">unsigned short GetOutputId(char *name) override</div><div class="ttdoc">return the output ids numbers of names used in output map</div><div class="ttdef"><b>Definition:</b> output_step.cc:364</div></div>
<div class="ttc" id="aclasscpart__step_html_adf52e27da153cb8c261a7366fcbce73b"><div class="ttname"><a href="classcpart__step.html#adf52e27da153cb8c261a7366fcbce73b">cpart_step::cpart_step</a></div><div class="ttdeci">cpart_step(const unsigned x, const unsigned y, const char *name, const char *type)</div><div class="ttdoc">constructor called once on part creation</div><div class="ttdef"><b>Definition:</b> output_step.cc:37</div></div>
<div class="ttc" id="aclasscpart__step_html_ae9c71fcf6de5804a5483d8e42c3edf57"><div class="ttname"><a href="classcpart__step.html#ae9c71fcf6de5804a5483d8e42c3edf57">cpart_step::PostProcess</a></div><div class="ttdeci">void PostProcess(void) override</div><div class="ttdoc">Called every end of CPU process.</div><div class="ttdef"><b>Definition:</b> output_step.cc:342</div></div>
<div class="ttc" id="aclasspart_html"><div class="ttname"><a href="classpart.html">part</a></div><div class="ttdoc">PART class.</div><div class="ttdef"><b>Definition:</b> part.h:49</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="pcode"></a>
output_step.cc</h2>
<div class="fragment"><div class="line"><span class="comment">/* ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   PICSimLab - Programmable IC Simulator Laboratory</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   Copyright (c) : 2010-2023  Luis Claudio Gambôa Lopes &lt;lcgamboa@yahoo.com&gt;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span></div>
<div class="line"><span class="comment">   any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">   along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   For e-mail suggestions :  lcgamboa@yahoo.com</span></div>
<div class="line"><span class="comment">   ######################################################################## */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;output_step.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/oscilloscope.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/picsimlab.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/spareparts.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* outputs */</span></div>
<div class="line"><span class="keyword">enum</span> { O_P1, O_P2, O_P3, O_P4, O_P5, O_L1, O_L2, O_L3, O_L4, O_ROT, O_STEPS };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_struct" href="struct_p_c_w_prop.html">PCWProp</a> pcwprop[6] = {{PCW_COMBO, <span class="stringliteral">&quot;Pin 1&quot;</span>}, {PCW_COMBO, <span class="stringliteral">&quot;Pin 2&quot;</span>}, {PCW_COMBO, <span class="stringliteral">&quot;Pin 3&quot;</span>},</div>
<div class="line">                             {PCW_COMBO, <span class="stringliteral">&quot;Pin 4&quot;</span>}, {PCW_COMBO, <span class="stringliteral">&quot;Home&quot;</span>},  {PCW_END, <span class="stringliteral">&quot;&quot;</span>}};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="classcpart__step.html#adf52e27da153cb8c261a7366fcbce73b">cpart_step::cpart_step</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> x, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> y, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <span class="keywordtype">char</span>* type)</div>
<div class="line">    : <a class="code hl_class" href="classpart.html">part</a>(x, y, name, type), font(9, lxFONTFAMILY_TELETYPE, lxFONTSTYLE_NORMAL, lxFONTWEIGHT_BOLD) {</div>
<div class="line">    angle = 0;</div>
<div class="line"> </div>
<div class="line">    steps = 0;</div>
<div class="line"> </div>
<div class="line">    input_pins[0] = 0;</div>
<div class="line">    input_pins[1] = 0;</div>
<div class="line">    input_pins[2] = 0;</div>
<div class="line">    input_pins[3] = 0;</div>
<div class="line"> </div>
<div class="line">    output_pins[0] = 0;</div>
<div class="line"> </div>
<div class="line">    input[0] = 0;</div>
<div class="line">    input[1] = 0;</div>
<div class="line"> </div>
<div class="line">    turns = 0;</div>
<div class="line"> </div>
<div class="line">    SetPCWProperties(pcwprop);</div>
<div class="line"> </div>
<div class="line">    PinCount = 4;</div>
<div class="line">    Pins = input_pins;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="classcpart__step.html#a91a0941165fa7531f44c7b74321533f3">cpart_step::~cpart_step</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keyword">delete</span> <a class="code hl_variable" href="classpart.html#a5edfdd836fc264f0e1047d002e4e7e18">Bitmap</a>;</div>
<div class="line">    <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Destroy();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a406716b623a2635c48eefe7630a2d8c9">cpart_step::DrawOutput</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i) {</div>
<div class="line">    <span class="keywordtype">float</span> x2, y2;</div>
<div class="line">    <span class="keyword">const</span> picpin* ppins = SpareParts.GetPinsValues();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<span class="keywordtype">id</span>) {</div>
<div class="line">        <span class="keywordflow">case</span> O_P1:</div>
<div class="line">        <span class="keywordflow">case</span> O_P2:</div>
<div class="line">        <span class="keywordflow">case</span> O_P3:</div>
<div class="line">        <span class="keywordflow">case</span> O_P4:</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetColor(49, 61, 99);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Rectangle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(255, 255, 255);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<span class="keywordtype">id</span> - O_P1] == 0)</div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(<span class="stringliteral">&quot;NC&quot;</span>, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, 0);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(SpareParts.<a class="code hl_function" href="class_c_spare_parts.html#a56db36d1a8c49ca039b5feb083f4fed0">GetPinName</a>(<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a7c42d3f23b23b1fa08f869f269104a9e">id</a> - O_P1]), <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">x1</a>, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a3ea90d25dafd4e3f279f3f541a956ffa">y1</a>,</div>
<div class="line">                                   0);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> O_P5:</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetColor(49, 61, 99);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Rectangle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(255, 255, 255);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<span class="keywordtype">id</span> - O_P5] == 0)</div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(<span class="stringliteral">&quot;NC&quot;</span>, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, 0);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(SpareParts.<a class="code hl_function" href="class_c_spare_parts.html#a56db36d1a8c49ca039b5feb083f4fed0">GetPinName</a>(<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a7c42d3f23b23b1fa08f869f269104a9e">id</a> - O_P5]), <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">x1</a>, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a3ea90d25dafd4e3f279f3f541a956ffa">y1</a>,</div>
<div class="line">                                   0);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> O_STEPS: {</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetColor(49, 61, 99);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Rectangle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y2 - <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(255, 255, 255);</div>
<div class="line">            lxString text;</div>
<div class="line">            text.Printf(<span class="stringliteral">&quot;S=%5.1f&quot;</span>, steps);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(text, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, 0);</div>
<div class="line">            text.Printf(<span class="stringliteral">&quot;T=%3i&quot;</span>, turns);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.RotatedText(text, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1 + 12, 0);</div>
<div class="line">        } <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> O_ROT:</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetColor(77, 77, 77);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Circle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r + 10);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(0, 0, 0);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(250, 250, 250);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Circle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(55, 55, 55);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Circle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r / 3);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetLineWidth(8);</div>
<div class="line">            x2 = <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">x1</a> + (<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r - 2) * sin(angle);</div>
<div class="line">            y2 = <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a3ea90d25dafd4e3f279f3f541a956ffa">y1</a> + (<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r - 2) * cos(angle);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Line(<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, x2, y2);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetLineWidth(6);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(77, 77, 77);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Line(<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, x2, y2);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetLineWidth(1);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> O_L1:</div>
<div class="line">        <span class="keywordflow">case</span> O_L2:</div>
<div class="line">        <span class="keywordflow">case</span> O_L3:</div>
<div class="line">        <span class="keywordflow">case</span> O_L4:</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetFgColor(0, 0, 0);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<span class="keywordtype">id</span> - O_L1] &gt; 0) {</div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[<a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].<span class="keywordtype">id</span> - O_L1] - 1].oavalue, 0, 0);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(55, 0, 0);</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// draw a LED</span></div>
<div class="line">            color1 = <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.GetBgColor();</div>
<div class="line">            <span class="keywordtype">int</span> r = color1.Red() - 120;</div>
<div class="line">            <span class="keywordtype">int</span> g = color1.Green() - 120;</div>
<div class="line">            <span class="keywordtype">int</span> b = color1.Blue() - 120;</div>
<div class="line">            <span class="keywordflow">if</span> (r &lt; 0)</div>
<div class="line">                r = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (g &lt; 0)</div>
<div class="line">                g = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (b &lt; 0)</div>
<div class="line">                b = 0;</div>
<div class="line">            color2.Set(r, g, b);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(color2);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Circle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r + 1);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.SetBgColor(color1);</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">canvas</a>.Circle(1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].x1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].y1, <a class="code hl_variable" href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">output</a>[i].r - 2);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a19c45dc044f0d8484d775a5da8fa95ec">cpart_step::PreProcess</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0] &gt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> ((steps == 0) &amp;&amp; (turns == 0)) {</div>
<div class="line">            SpareParts.SetPin(<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0], 0);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            SpareParts.SetPin(<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0], 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define STEP (1.8 * M_PI / 180.0)</span></div>
<div class="line"><span class="preprocessor">#define HSTEP (STEP / 2.0)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NSTEP 200  </span><span class="comment">// 360/1.8</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define S1 1</span></div>
<div class="line"><span class="preprocessor">#define S12 3</span></div>
<div class="line"><span class="preprocessor">#define S2 2</span></div>
<div class="line"><span class="preprocessor">#define S23 6</span></div>
<div class="line"><span class="preprocessor">#define S3 4</span></div>
<div class="line"><span class="preprocessor">#define S34 12</span></div>
<div class="line"><span class="preprocessor">#define S4 8</span></div>
<div class="line"><span class="preprocessor">#define S41 9</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a6892916acaf8198565079b952c61d846">cpart_step::Process</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keyword">const</span> picpin* ppins = SpareParts.GetPinsValues();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0] &gt; 0) &amp;&amp; (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1] &gt; 0) &amp;&amp; (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2] &gt; 0) &amp;&amp; (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3] &gt; 0)) {</div>
<div class="line">        input[1] = input[0];</div>
<div class="line">        input[0] = (ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0] - 1].value &lt;&lt; 3) | (ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1] - 1].value &lt;&lt; 2) |</div>
<div class="line">                   (ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2] - 1].value &lt;&lt; 1) | ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3] - 1].value;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (input[0] ^ input[1]) {</div>
<div class="line">            <span class="keywordflow">switch</span> (input[0]) {</div>
<div class="line">                <span class="keywordflow">case</span> S1:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S4:  <span class="comment">// foward full step</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S2:  <span class="comment">// backward full step</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S41:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S12:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S2:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S1:  <span class="comment">// foward full step</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S3:  <span class="comment">// backward full step</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S12:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S23:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S3:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S2:  <span class="comment">// foward full step</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S4:  <span class="comment">// backward full step</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S23:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S34:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S4:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S3:  <span class="comment">// foward full step</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S1:  <span class="comment">// backward full step</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S34:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S41:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S12:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S41:  <span class="comment">// foward full step double phase</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S23:  <span class="comment">// backward full step double phase</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S1:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S2:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S23:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S12:  <span class="comment">// foward full step double phase</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S34:  <span class="comment">// backward full step double phase</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S2:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S3:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S34:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S23:  <span class="comment">// foward full step double phase</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S41:  <span class="comment">// backward full step double phase</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S3:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S4:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> S41:</div>
<div class="line">                    <span class="keywordflow">switch</span> (input[1]) {</div>
<div class="line">                        <span class="keywordflow">case</span> S34:  <span class="comment">// foward full step double phase</span></div>
<div class="line">                            steps += 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S12:  <span class="comment">// backward full step double phase</span></div>
<div class="line">                            steps -= 1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S4:  <span class="comment">// foward half step</span></div>
<div class="line">                            steps += 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> S1:  <span class="comment">// backward half step</span></div>
<div class="line">                            steps -= 0.5;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:  <span class="comment">// invalid</span></div>
<div class="line">                    input[0] = input[1];</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (steps &gt;= NSTEP) {</div>
<div class="line">                steps -= NSTEP;</div>
<div class="line">                turns++;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (steps &lt; 0) {</div>
<div class="line">                steps += NSTEP;</div>
<div class="line">                turns--;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            angle = STEP * steps;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0] &gt; 0) {</div>
<div class="line">                <span class="keywordflow">if</span> ((steps == 0) &amp;&amp; (turns == 0)) {</div>
<div class="line">                    SpareParts.SetPin(<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0], 0);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    SpareParts.SetPin(<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0], 1);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#ae9c71fcf6de5804a5483d8e42c3edf57">cpart_step::PostProcess</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keyword">const</span> picpin* ppins = SpareParts.GetPinsValues();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[i] &amp;&amp; (<a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_L1 + i]-&gt;value != ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[i] - 1].oavalue)) {</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_L1 + i]-&gt;<a class="code hl_variable" href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">value</a> = ppins[<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[i] - 1].oavalue;</div>
<div class="line">            <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_L1 + i]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_ROT]-&gt;value_f != angle) {</div>
<div class="line">        <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_ROT]-&gt;<a class="code hl_variable" href="structoutput__t.html#a9b57cc8e6b609a849171298f1fcf1f9f">value_f</a> = angle;</div>
<div class="line">        <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_ROT]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">        <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_STEPS]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcpart__step.html#a55297faec243e7aab6a1cb9a21031bc7">cpart_step::GetInputId</a>(<span class="keywordtype">char</span>* name) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Erro input &#39;%s&#39; don&#39;t have a valid id! \n&quot;</span>, name);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcpart__step.html#ab42f4bd7f3f11d659cdbe726323edc9a">cpart_step::GetOutputId</a>(<span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PN_1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_P1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PN_2&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_P2;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PN_3&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_P3;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PN_4&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_P4;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PN_5&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_P5;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_L1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_2&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_L2;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_3&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_L3;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_4&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_L4;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;DG_ROT&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_ROT;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;DI_STEPS&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_STEPS;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Erro output &#39;%s&#39; don&#39;t have a valid id! \n&quot;</span>, name);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">lxString <a class="code hl_function" href="classcpart__step.html#a6226f0a8ad635fb166a37b52f3d8d912">cpart_step::WritePreferences</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordtype">char</span> prefs[256];</div>
<div class="line"> </div>
<div class="line">    sprintf(prefs, <span class="stringliteral">&quot;%hhu,%hhu,%hhu,%hhu,%hhu&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0], <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1], <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2], <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3],</div>
<div class="line">            <a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> prefs;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#aae902fc383b486ab1b9d40b83aea65a3">cpart_step::ReadPreferences</a>(lxString value) {</div>
<div class="line">    sscanf(value.c_str(), <span class="stringliteral">&quot;%hhu,%hhu,%hhu,%hhu,%hhu&quot;</span>, &amp;<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0], &amp;<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1], &amp;<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2], &amp;<a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3],</div>
<div class="line">           &amp;<a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a9023bfe76e703c10930a713591165743">cpart_step::RegisterRemoteControl</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <a class="code hl_variable" href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">output_ids</a>[O_ROT]-&gt;<a class="code hl_variable" href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">status</a> = (<span class="keywordtype">void</span>*)&amp;angle;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a6a5fbbfff34b78315a3f012f62a08431">cpart_step::ConfigurePropertiesWindow</a>(CPWindow* WProp) {</div>
<div class="line">    SetPCWComboWithPinNames(WProp, <span class="stringliteral">&quot;combo1&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0]);</div>
<div class="line">    SetPCWComboWithPinNames(WProp, <span class="stringliteral">&quot;combo2&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1]);</div>
<div class="line">    SetPCWComboWithPinNames(WProp, <span class="stringliteral">&quot;combo3&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2]);</div>
<div class="line">    SetPCWComboWithPinNames(WProp, <span class="stringliteral">&quot;combo4&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3]);</div>
<div class="line">    SetPCWComboWithPinNames(WProp, <span class="stringliteral">&quot;combo5&quot;</span>, <a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcpart__step.html#a623a12a47674716ed3e71a840b0b7cb8">cpart_step::ReadPropertiesWindow</a>(CPWindow* WProp) {</div>
<div class="line">    <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[0] = GetPWCComboSelectedPin(WProp, <span class="stringliteral">&quot;combo1&quot;</span>);</div>
<div class="line">    <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[1] = GetPWCComboSelectedPin(WProp, <span class="stringliteral">&quot;combo2&quot;</span>);</div>
<div class="line">    <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[2] = GetPWCComboSelectedPin(WProp, <span class="stringliteral">&quot;combo3&quot;</span>);</div>
<div class="line">    <a class="code hl_variable" href="classcpart__step.html#a3da50407c2419060293a8a7d6da931fa">input_pins</a>[3] = GetPWCComboSelectedPin(WProp, <span class="stringliteral">&quot;combo4&quot;</span>);</div>
<div class="line">    <a class="code hl_variable" href="classcpart__step.html#a7ee6c2cbf8b8fcf3757b8a4d999d5903">output_pins</a>[0] = GetPWCComboSelectedPin(WProp, <span class="stringliteral">&quot;combo5&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">part_init(PART_STEP_Name, <a class="code hl_class" href="classcpart__step.html">cpart_step</a>, <span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="ttc" id="aclass_c_spare_parts_html_a56db36d1a8c49ca039b5feb083f4fed0"><div class="ttname"><a href="class_c_spare_parts.html#a56db36d1a8c49ca039b5feb083f4fed0">CSpareParts::GetPinName</a></div><div class="ttdeci">lxString GetPinName(unsigned char pin)</div><div class="ttdoc">Return the name of one pin.</div><div class="ttdef"><b>Definition:</b> spareparts.cc:154</div></div>
<div class="ttc" id="aclasspart_html_a03d90e1490c5dfb116669ea11f90b740"><div class="ttname"><a href="classpart.html#a03d90e1490c5dfb116669ea11f90b740">part::output_ids</a></div><div class="ttdeci">output_t * output_ids[100]</div><div class="ttdoc">output map elements by id order</div><div class="ttdef"><b>Definition:</b> part.h:374</div></div>
<div class="ttc" id="aclasspart_html_a074fcb74e58bd5f199ce043a500d1c69"><div class="ttname"><a href="classpart.html#a074fcb74e58bd5f199ce043a500d1c69">part::output</a></div><div class="ttdeci">output_t output[100]</div><div class="ttdoc">output map elements</div><div class="ttdef"><b>Definition:</b> part.h:373</div></div>
<div class="ttc" id="aclasspart_html_a4adcfbd9da4f9e196fd7f50ce829d817"><div class="ttname"><a href="classpart.html#a4adcfbd9da4f9e196fd7f50ce829d817">part::canvas</a></div><div class="ttdeci">CCanvas canvas</div><div class="ttdoc">Internal Canvas to draw in bitmap.</div><div class="ttdef"><b>Definition:</b> part.h:382</div></div>
<div class="ttc" id="aclasspart_html_a5edfdd836fc264f0e1047d002e4e7e18"><div class="ttname"><a href="classpart.html#a5edfdd836fc264f0e1047d002e4e7e18">part::Bitmap</a></div><div class="ttdeci">lxBitmap * Bitmap</div><div class="ttdoc">Internal Bitmap.</div><div class="ttdef"><b>Definition:</b> part.h:381</div></div>
<div class="ttc" id="astruct_p_c_w_prop_html"><div class="ttname"><a href="struct_p_c_w_prop.html">PCWProp</a></div><div class="ttdef"><b>Definition:</b> part.h:39</div></div>
<div class="ttc" id="astructoutput__t_html_a23bc69196fed4d0e4924453a11e182bd"><div class="ttname"><a href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">output_t::value</a></div><div class="ttdeci">unsigned char value</div><div class="ttdoc">updated value</div><div class="ttdef"><b>Definition:</b> board.h:78</div></div>
<div class="ttc" id="astructoutput__t_html_a394c193a9f75a821997918c3fe8525a5"><div class="ttname"><a href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">output_t::status</a></div><div class="ttdeci">void * status</div><div class="ttdoc">rcontrol status</div><div class="ttdef"><b>Definition:</b> board.h:75</div></div>
<div class="ttc" id="astructoutput__t_html_a3ea90d25dafd4e3f279f3f541a956ffa"><div class="ttname"><a href="structoutput__t.html#a3ea90d25dafd4e3f279f3f541a956ffa">output_t::y1</a></div><div class="ttdeci">unsigned int y1</div><div class="ttdoc">y1 position</div><div class="ttdef"><b>Definition:</b> board.h:68</div></div>
<div class="ttc" id="astructoutput__t_html_a4a26c232a33f2387180a8bc0b6c078e7"><div class="ttname"><a href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">output_t::x1</a></div><div class="ttdeci">unsigned int x1</div><div class="ttdoc">x1 position</div><div class="ttdef"><b>Definition:</b> board.h:66</div></div>
<div class="ttc" id="astructoutput__t_html_a7c42d3f23b23b1fa08f869f269104a9e"><div class="ttname"><a href="structoutput__t.html#a7c42d3f23b23b1fa08f869f269104a9e">output_t::id</a></div><div class="ttdeci">unsigned short id</div><div class="ttdoc">region ID</div><div class="ttdef"><b>Definition:</b> board.h:74</div></div>
<div class="ttc" id="astructoutput__t_html_a9b57cc8e6b609a849171298f1fcf1f9f"><div class="ttname"><a href="structoutput__t.html#a9b57cc8e6b609a849171298f1fcf1f9f">output_t::value_f</a></div><div class="ttdeci">float value_f</div><div class="ttdoc">updated value float</div><div class="ttdef"><b>Definition:</b> board.h:80</div></div>
<div class="ttc" id="astructoutput__t_html_aa91b1205a6823abba2269f91bb87863d"><div class="ttname"><a href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">output_t::update</a></div><div class="ttdeci">unsigned char update</div><div class="ttdoc">need draw update</div><div class="ttdef"><b>Definition:</b> board.h:76</div></div>
</div><!-- fragment --><h1><a class="anchor" id="boardex"></a>
Board example</h1>
<h2><a class="anchor" id="binc"></a>
board_x.h</h2>
<div class="fragment"><div class="line"><span class="comment">/* ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   PICSimLab - Programmable IC Simulator Laboratory</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   Copyright (c) : 2015-2023  Luis Claudio Gambôa Lopes &lt;lcgamboa@yahoo.com&gt;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span></div>
<div class="line"><span class="comment">   any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">   along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   For e-mail suggestions :  lcgamboa@yahoo.com</span></div>
<div class="line"><span class="comment">   ######################################################################## */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef BOARD_x_H</span></div>
<div class="line"><span class="preprocessor">#define BOARD_x_H</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;lxrad.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;../devices/swbounce.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;bsim_picsim.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define BOARD_x_Name &quot;X&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// new board class must be derived from board class defined in board.h</span></div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classcboard__x.html">cboard_x</a> : <span class="keyword">public</span> <a class="code hl_class" href="classbsim__picsim.html">bsim_picsim</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_BT1;  <span class="comment">// first board push button in RD0</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_BT2;  <span class="comment">// second board switch in RD1</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// value of potentiometer</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pot1;</div>
<div class="line">    <span class="comment">// flag to control if potentiometer is active</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> active;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// controls to be added in simulator window</span></div>
<div class="line">    CGauge* gauge1;  <span class="comment">// gauge to show mean value of RB0</span></div>
<div class="line">    CGauge* gauge2;  <span class="comment">// gauge to show mean value of RB1</span></div>
<div class="line">    CLabel* label2;  <span class="comment">// label of gauge RB0</span></div>
<div class="line">    CLabel* label3;  <span class="comment">// label of gauge RB1</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Register controls for remote interface called once on board creation</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a9c1664ce551c79209b4e6dc9d0ed8730">RegisterRemoteControl</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    lxColor color1;  <span class="comment">// LEDs color 1</span></div>
<div class="line">    lxColor color2;  <span class="comment">// LEDs color 2</span></div>
<div class="line">    lxFont font;</div>
<div class="line">    <a class="code hl_struct" href="struct_s_w_bounce__t.html">SWBounce_t</a> bounce;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Constructor called once on board creation</span></div>
<div class="line">    <a class="code hl_class" href="classcboard__x.html">cboard_x</a>(<span class="keywordtype">void</span>);</div>
<div class="line">    <span class="comment">// Destructor called once on board destruction</span></div>
<div class="line">    <a class="code hl_class" href="classcboard__x.html">~cboard_x</a>(<span class="keywordtype">void</span>);</div>
<div class="line">    <span class="comment">// Return the board name</span></div>
<div class="line">    lxString <a class="code hl_function" href="classcboard__x.html#a350e7f7b3a7edd49c2021c30cc3a18f4">GetName</a>(<span class="keywordtype">void</span>)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> lxT(BOARD_x_Name); };</div>
<div class="line">    <span class="comment">// Return the about info of board</span></div>
<div class="line">    lxString <a class="code hl_function" href="classcboard__x.html#a3d75167fedb903b74a8920476214f701">GetAboutInfo</a>(<span class="keywordtype">void</span>)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> lxT(<span class="stringliteral">&quot;L.C. Gamboa \n &lt;lcgamboa@yahoo.com&gt;&quot;</span>); };</div>
<div class="line">    <span class="comment">// Called ever 100ms to draw board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a18ebbd336dc27b64c0fdcc6a5d580ee4">Draw</a>(CDraw* draw) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a6337aae979579d9d180026dfcd2c55c0">Run_CPU</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Return a list of board supported microcontrollers</span></div>
<div class="line">    lxString <a class="code hl_function" href="classcboard__x.html#a4e642d592813f132be2227a4af97bb3e">GetSupportedDevices</a>(<span class="keywordtype">void</span>)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> lxT(<span class="stringliteral">&quot;PIC16F877A,PIC18F4550,PIC18F4620,&quot;</span>); };</div>
<div class="line">    <span class="comment">// Reset board status</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">Reset</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Event on the board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a54f0b84ecd3973bdd3f7d8b7d13cc0b9">EvMouseButtonPress</a>(uint button, uint x, uint y, uint state) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Event on the board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#abb94877b3a91eb371b3b20e2e9cebcce">EvMouseButtonRelease</a>(uint button, uint x, uint y, uint state) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Event on the board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#acfd3a83c6a0ece11eb8d88dd9fa102f9">EvMouseMove</a>(uint button, uint x, uint y, uint state) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Event on the board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a3db74c02199e114e22f7a7a5b4e3dd96">EvKeyPress</a>(uint key, uint mask) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Event on the board</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#aef95af41c7e6c527dfe9e522912a19a2">EvKeyRelease</a>(uint key, uint mask) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Called ever 1s to refresh status</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a1492d042e89665dba3924b193f5bf9cc">RefreshStatus</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Called to save board preferences in configuration file</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a5603baefc099825eeb53634ece32b2f8">WritePreferences</a>(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// Called whe configuration file load  preferences</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a696180daddb7dfc9b5bf5ad45fca0124">ReadPreferences</a>(<span class="keywordtype">char</span>* name, <span class="keywordtype">char</span>* value) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// return the input ids numbers of names used in input map</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcboard__x.html#a870b8977726aba5c91a863efb1175c1f">GetInputId</a>(<span class="keywordtype">char</span>* name) <span class="keyword">override</span>;</div>
<div class="line">    <span class="comment">// return the output ids numbers of names used in output map</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcboard__x.html#a99605f65ae5f4a210d57113fa805194e">GetOutputId</a>(<span class="keywordtype">char</span>* name) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BOARD_x_H */</span><span class="preprocessor"></span></div>
<div class="ttc" id="aclassbsim__picsim_html"><div class="ttname"><a href="classbsim__picsim.html">bsim_picsim</a></div><div class="ttdef"><b>Definition:</b> bsim_picsim.h:33</div></div>
<div class="ttc" id="aclasscboard__x_html"><div class="ttname"><a href="classcboard__x.html">cboard_x</a></div><div class="ttdef"><b>Definition:</b> board_x.h:37</div></div>
<div class="ttc" id="aclasscboard__x_html_a1492d042e89665dba3924b193f5bf9cc"><div class="ttname"><a href="classcboard__x.html#a1492d042e89665dba3924b193f5bf9cc">cboard_x::RefreshStatus</a></div><div class="ttdeci">void RefreshStatus(void) override</div><div class="ttdoc">Called ever 1s to refresh status.</div><div class="ttdef"><b>Definition:</b> board_x.cc:247</div></div>
<div class="ttc" id="aclasscboard__x_html_a18ebbd336dc27b64c0fdcc6a5d580ee4"><div class="ttname"><a href="classcboard__x.html#a18ebbd336dc27b64c0fdcc6a5d580ee4">cboard_x::Draw</a></div><div class="ttdeci">void Draw(CDraw *draw) override</div><div class="ttdoc">Called ever 100ms to draw board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:451</div></div>
<div class="ttc" id="aclasscboard__x_html_a350e7f7b3a7edd49c2021c30cc3a18f4"><div class="ttname"><a href="classcboard__x.html#a350e7f7b3a7edd49c2021c30cc3a18f4">cboard_x::GetName</a></div><div class="ttdeci">lxString GetName(void) override</div><div class="ttdoc">Get board name registered in PICSimLab.</div><div class="ttdef"><b>Definition:</b> board_x.h:67</div></div>
<div class="ttc" id="aclasscboard__x_html_a3d75167fedb903b74a8920476214f701"><div class="ttname"><a href="classcboard__x.html#a3d75167fedb903b74a8920476214f701">cboard_x::GetAboutInfo</a></div><div class="ttdeci">lxString GetAboutInfo(void) override</div><div class="ttdoc">Return the about information of part.</div><div class="ttdef"><b>Definition:</b> board_x.h:69</div></div>
<div class="ttc" id="aclasscboard__x_html_a3db74c02199e114e22f7a7a5b4e3dd96"><div class="ttname"><a href="classcboard__x.html#a3db74c02199e114e22f7a7a5b4e3dd96">cboard_x::EvKeyPress</a></div><div class="ttdeci">void EvKeyPress(uint key, uint mask) override</div><div class="ttdoc">Event on the board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:304</div></div>
<div class="ttc" id="aclasscboard__x_html_a4e642d592813f132be2227a4af97bb3e"><div class="ttname"><a href="classcboard__x.html#a4e642d592813f132be2227a4af97bb3e">cboard_x::GetSupportedDevices</a></div><div class="ttdeci">lxString GetSupportedDevices(void) override</div><div class="ttdoc">Return a list of supported microcontrollers.</div><div class="ttdef"><b>Definition:</b> board_x.h:74</div></div>
<div class="ttc" id="aclasscboard__x_html_a54f0b84ecd3973bdd3f7d8b7d13cc0b9"><div class="ttname"><a href="classcboard__x.html#a54f0b84ecd3973bdd3f7d8b7d13cc0b9">cboard_x::EvMouseButtonPress</a></div><div class="ttdeci">void EvMouseButtonPress(uint button, uint x, uint y, uint state) override</div><div class="ttdoc">Event on the board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:330</div></div>
<div class="ttc" id="aclasscboard__x_html_a5603baefc099825eeb53634ece32b2f8"><div class="ttname"><a href="classcboard__x.html#a5603baefc099825eeb53634ece32b2f8">cboard_x::WritePreferences</a></div><div class="ttdeci">void WritePreferences(void) override</div><div class="ttdoc">Called to save board preferences in configuration file.</div><div class="ttdef"><b>Definition:</b> board_x.cc:266</div></div>
<div class="ttc" id="aclasscboard__x_html_a6337aae979579d9d180026dfcd2c55c0"><div class="ttname"><a href="classcboard__x.html#a6337aae979579d9d180026dfcd2c55c0">cboard_x::Run_CPU</a></div><div class="ttdeci">void Run_CPU(void) override</div><div class="ttdoc">Paralle thread called ever 100ms to run cpu code.</div><div class="ttdef"><b>Definition:</b> board_x.cc:584</div></div>
<div class="ttc" id="aclasscboard__x_html_a696180daddb7dfc9b5bf5ad45fca0124"><div class="ttname"><a href="classcboard__x.html#a696180daddb7dfc9b5bf5ad45fca0124">cboard_x::ReadPreferences</a></div><div class="ttdeci">void ReadPreferences(char *name, char *value) override</div><div class="ttdoc">Called whe configuration file load preferences.</div><div class="ttdef"><b>Definition:</b> board_x.cc:279</div></div>
<div class="ttc" id="aclasscboard__x_html_a6f87b4f00b9297a5893a805820c4a436"><div class="ttname"><a href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">cboard_x::Reset</a></div><div class="ttdeci">void Reset(void) override</div><div class="ttdoc">Reset board status.</div><div class="ttdef"><b>Definition:</b> board_x.cc:190</div></div>
<div class="ttc" id="aclasscboard__x_html_a870b8977726aba5c91a863efb1175c1f"><div class="ttname"><a href="classcboard__x.html#a870b8977726aba5c91a863efb1175c1f">cboard_x::GetInputId</a></div><div class="ttdeci">unsigned short GetInputId(char *name) override</div><div class="ttdoc">return the input ids numbers of names used in input map</div><div class="ttdef"><b>Definition:</b> board_x.cc:58</div></div>
<div class="ttc" id="aclasscboard__x_html_a99605f65ae5f4a210d57113fa805194e"><div class="ttname"><a href="classcboard__x.html#a99605f65ae5f4a210d57113fa805194e">cboard_x::GetOutputId</a></div><div class="ttdeci">unsigned short GetOutputId(char *name) override</div><div class="ttdoc">return the output ids numbers of names used in output map</div><div class="ttdef"><b>Definition:</b> board_x.cc:78</div></div>
<div class="ttc" id="aclasscboard__x_html_a9c1664ce551c79209b4e6dc9d0ed8730"><div class="ttname"><a href="classcboard__x.html#a9c1664ce551c79209b4e6dc9d0ed8730">cboard_x::RegisterRemoteControl</a></div><div class="ttdeci">void RegisterRemoteControl(void) override</div><div class="ttdoc">Register remote control variables.</div><div class="ttdef"><b>Definition:</b> board_x.cc:227</div></div>
<div class="ttc" id="aclasscboard__x_html_abb94877b3a91eb371b3b20e2e9cebcce"><div class="ttname"><a href="classcboard__x.html#abb94877b3a91eb371b3b20e2e9cebcce">cboard_x::EvMouseButtonRelease</a></div><div class="ttdeci">void EvMouseButtonRelease(uint button, uint x, uint y, uint state) override</div><div class="ttdoc">Event on the board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:413</div></div>
<div class="ttc" id="aclasscboard__x_html_acfd3a83c6a0ece11eb8d88dd9fa102f9"><div class="ttname"><a href="classcboard__x.html#acfd3a83c6a0ece11eb8d88dd9fa102f9">cboard_x::EvMouseMove</a></div><div class="ttdeci">void EvMouseMove(uint button, uint x, uint y, uint state) override</div><div class="ttdoc">Event on the board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:390</div></div>
<div class="ttc" id="aclasscboard__x_html_aef95af41c7e6c527dfe9e522912a19a2"><div class="ttname"><a href="classcboard__x.html#aef95af41c7e6c527dfe9e522912a19a2">cboard_x::EvKeyRelease</a></div><div class="ttdeci">void EvKeyRelease(uint key, uint mask) override</div><div class="ttdoc">Event on the board.</div><div class="ttdef"><b>Definition:</b> board_x.cc:320</div></div>
<div class="ttc" id="astruct_s_w_bounce__t_html"><div class="ttname"><a href="struct_s_w_bounce__t.html">SWBounce_t</a></div><div class="ttdef"><b>Definition:</b> swbounce.h:29</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="bcode"></a>
board_x.cc</h2>
<div class="fragment"><div class="line"><span class="comment">/* ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   PICSimLab - Programmable IC Simulator Laboratory</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   ########################################################################</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   Copyright (c) : 2015-2023  Luis Claudio Gambôa Lopes &lt;lcgamboa@yahoo.com&gt;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span></div>
<div class="line"><span class="comment">   any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">   along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   For e-mail suggestions :  lcgamboa@yahoo.com</span></div>
<div class="line"><span class="comment">   ######################################################################## */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// include files</span></div>
<div class="line"><span class="preprocessor">#include &quot;board_x.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/oscilloscope.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/picsimlab.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../lib/spareparts.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ids of inputs of input map*/</span></div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">    I_POT1,  <span class="comment">// potentiometer</span></div>
<div class="line">    I_ICSP,  <span class="comment">// ICSP connector</span></div>
<div class="line">    I_PWR,   <span class="comment">// Power button</span></div>
<div class="line">    I_RST,   <span class="comment">// Reset button</span></div>
<div class="line">    I_BD0,   <span class="comment">// RD0 push button</span></div>
<div class="line">    I_SD1    <span class="comment">// RD1 switch</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ids of outputs of output map*/</span></div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">    O_POT1,  <span class="comment">// potentiometer</span></div>
<div class="line">    O_RST,   <span class="comment">// Reset button</span></div>
<div class="line">    O_SD1,   <span class="comment">// switch position (On/Off)</span></div>
<div class="line">    O_LD0,   <span class="comment">// LED on RD0 push button</span></div>
<div class="line">    O_LD1,   <span class="comment">// LED on RD1 switch</span></div>
<div class="line">    O_LPWR,  <span class="comment">// Power LED</span></div>
<div class="line">    O_RB0,   <span class="comment">// LED on RB0 output</span></div>
<div class="line">    O_RB1,   <span class="comment">// LED on RB1 output</span></div>
<div class="line">    O_BD0,   <span class="comment">// RD1 switch</span></div>
<div class="line">    O_CPU    <span class="comment">// CPU name</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// return the input ids numbers of names used in input map</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcboard__x.html#a870b8977726aba5c91a863efb1175c1f">cboard_x::GetInputId</a>(<span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PG_ICSP&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_ICSP;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;SW_PWR&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_PWR;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PB_RST&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_RST;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PB_D0&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_BD0;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;SW_D1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_SD1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PO_1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> I_POT1;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Error input &#39;%s&#39; don&#39;t have a valid id! \n&quot;</span>, name);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// return the output ids numbers of names used in output map</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_function" href="classcboard__x.html#a99605f65ae5f4a210d57113fa805194e">cboard_x::GetOutputId</a>(<span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;SW_D1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_SD1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_LD0&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_LD0;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_LD1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_LD1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_LPWR&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_LPWR;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_RB1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_RB1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;LD_RB0&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_RB0;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PB_D0&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_BD0;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PO_1&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_POT1;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;PB_RST&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_RST;</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;IC_CPU&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> O_CPU;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Error output &#39;%s&#39; don&#39;t have a valid id! \n&quot;</span>, name);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Constructor called once on board creation</span></div>
<div class="line"> </div>
<div class="line">cboard_x::cboard_x(<span class="keywordtype">void</span>) : font(10, lxFONTFAMILY_TELETYPE, lxFONTSTYLE_NORMAL, lxFONTWEIGHT_BOLD) {</div>
<div class="line">    Proc = <span class="stringliteral">&quot;PIC18F4550&quot;</span>;  <span class="comment">// default microcontroller if none defined in preferences</span></div>
<div class="line">    ReadMaps();           <span class="comment">// Read input and output board maps</span></div>
<div class="line"> </div>
<div class="line">    pot1 = 100;</div>
<div class="line"> </div>
<div class="line">    active = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (PICSimLab.GetWindow()) {</div>
<div class="line">        <span class="comment">// controls properties and creation</span></div>
<div class="line">        <span class="comment">// gauge1</span></div>
<div class="line">        gauge1 = <span class="keyword">new</span> CGauge();</div>
<div class="line">        gauge1-&gt;SetFOwner(PICSimLab.GetWindow());</div>
<div class="line">        gauge1-&gt;SetName(lxT(<span class="stringliteral">&quot;gauge1_px&quot;</span>));</div>
<div class="line">        gauge1-&gt;SetX(13);</div>
<div class="line">        gauge1-&gt;SetY(382 - 160);</div>
<div class="line">        gauge1-&gt;SetWidth(140);</div>
<div class="line">        gauge1-&gt;SetHeight(20);</div>
<div class="line">        gauge1-&gt;SetEnable(1);</div>
<div class="line">        gauge1-&gt;SetVisible(1);</div>
<div class="line">        gauge1-&gt;SetRange(100);</div>
<div class="line">        gauge1-&gt;SetValue(0);</div>
<div class="line">        gauge1-&gt;SetType(4);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;CreateChild(gauge1);</div>
<div class="line">        <span class="comment">// gauge2</span></div>
<div class="line">        gauge2 = <span class="keyword">new</span> CGauge();</div>
<div class="line">        gauge2-&gt;SetFOwner(PICSimLab.GetWindow());</div>
<div class="line">        gauge2-&gt;SetName(lxT(<span class="stringliteral">&quot;gauge2_px&quot;</span>));</div>
<div class="line">        gauge2-&gt;SetX(12);</div>
<div class="line">        gauge2-&gt;SetY(330 - 160);</div>
<div class="line">        gauge2-&gt;SetWidth(140);</div>
<div class="line">        gauge2-&gt;SetHeight(20);</div>
<div class="line">        gauge2-&gt;SetEnable(1);</div>
<div class="line">        gauge2-&gt;SetVisible(1);</div>
<div class="line">        gauge2-&gt;SetRange(100);</div>
<div class="line">        gauge2-&gt;SetValue(0);</div>
<div class="line">        gauge2-&gt;SetType(4);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;CreateChild(gauge2);</div>
<div class="line">        <span class="comment">// label2</span></div>
<div class="line">        label2 = <span class="keyword">new</span> CLabel();</div>
<div class="line">        label2-&gt;SetFOwner(PICSimLab.GetWindow());</div>
<div class="line">        label2-&gt;SetName(lxT(<span class="stringliteral">&quot;label2_px&quot;</span>));</div>
<div class="line">        label2-&gt;SetX(12);</div>
<div class="line">        label2-&gt;SetY(306 - 160);</div>
<div class="line">        label2-&gt;SetWidth(60);</div>
<div class="line">        label2-&gt;SetHeight(20);</div>
<div class="line">        label2-&gt;SetEnable(1);</div>
<div class="line">        label2-&gt;SetVisible(1);</div>
<div class="line">        label2-&gt;SetText(lxT(<span class="stringliteral">&quot;RB0&quot;</span>));</div>
<div class="line">        label2-&gt;SetAlign(1);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;CreateChild(label2);</div>
<div class="line">        <span class="comment">// label3</span></div>
<div class="line">        label3 = <span class="keyword">new</span> CLabel();</div>
<div class="line">        label3-&gt;SetFOwner(PICSimLab.GetWindow());</div>
<div class="line">        label3-&gt;SetName(lxT(<span class="stringliteral">&quot;label3_px&quot;</span>));</div>
<div class="line">        label3-&gt;SetX(13);</div>
<div class="line">        label3-&gt;SetY(357 - 160);</div>
<div class="line">        label3-&gt;SetWidth(60);</div>
<div class="line">        label3-&gt;SetHeight(20);</div>
<div class="line">        label3-&gt;SetEnable(1);</div>
<div class="line">        label3-&gt;SetVisible(1);</div>
<div class="line">        label3-&gt;SetText(lxT(<span class="stringliteral">&quot;RB1&quot;</span>));</div>
<div class="line">        label3-&gt;SetAlign(1);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;CreateChild(label3);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    SWBounce_init(&amp;bounce, 2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Destructor called once on board destruction</span></div>
<div class="line"> </div>
<div class="line">cboard_x::~cboard_x(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordflow">if</span> (PICSimLab.GetWindow()) {</div>
<div class="line">        <span class="comment">// controls destruction</span></div>
<div class="line">        PICSimLab.GetWindow()-&gt;DestroyChild(gauge1);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;DestroyChild(gauge2);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;DestroyChild(label2);</div>
<div class="line">        PICSimLab.GetWindow()-&gt;DestroyChild(label3);</div>
<div class="line">    }</div>
<div class="line">    SWBounce_end(&amp;bounce);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reset board status</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">cboard_x::Reset</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    pic_reset(&amp;pic, 1);</div>
<div class="line"> </div>
<div class="line">    p_BT1 = 1;  <span class="comment">// set push button  in default state (high)</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// write button state to pic pin 19 (RD0)</span></div>
<div class="line">    pic_set_pin(&amp;pic, 19, p_BT1);</div>
<div class="line">    <span class="comment">// write switch state to pic pin 20 (RD1)</span></div>
<div class="line">    pic_set_pin(&amp;pic, 20, p_BT2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (PICSimLab.GetStatusBar()) {</div>
<div class="line">        <span class="comment">// verify serial port state and refresh status bar</span></div>
<div class="line"><span class="preprocessor">#ifndef _WIN_</span></div>
<div class="line">        <span class="keywordflow">if</span> (pic.serial[0].serialfd &gt; 0)</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">if</span> (pic.serial[0].serialfd != INVALID_HANDLE_VALUE)</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            PICSimLab.GetStatusBar()-&gt;SetField(</div>
<div class="line">                2, lxT(<span class="stringliteral">&quot;Serial: &quot;</span>) + lxString::FromAscii(SERIALDEVICE) + lxT(<span class="stringliteral">&quot;:&quot;</span>) + itoa(pic.serial[0].serialbaud) +</div>
<div class="line">                       lxT(<span class="stringliteral">&quot;(&quot;</span>) +</div>
<div class="line">                       lxString().Format(<span class="stringliteral">&quot;%4.1f&quot;</span>,</div>
<div class="line">                                         fabs((100.0 * pic.serial[0].serialexbaud - 100.0 * pic.serial[0].serialbaud) /</div>
<div class="line">                                              pic.serial[0].serialexbaud)) +</div>
<div class="line">                       lxT(<span class="stringliteral">&quot;%)&quot;</span>));</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            PICSimLab.GetStatusBar()-&gt;SetField(2,</div>
<div class="line">                                               lxT(<span class="stringliteral">&quot;Serial: &quot;</span>) + lxString::FromAscii(SERIALDEVICE) + lxT(<span class="stringliteral">&quot; (ERROR)&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#ac41e7f65ae979416dd133853774e206e">use_spare</a>)</div>
<div class="line">        SpareParts.Reset();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="classcboard__x.html#a9c1664ce551c79209b4e6dc9d0ed8730">RegisterRemoteControl</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Register variables to be controled by remote control</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a9c1664ce551c79209b4e6dc9d0ed8730">cboard_x::RegisterRemoteControl</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">// register inputa</span></div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_BD0]-&gt;<a class="code hl_variable" href="structinput__t.html#aa46e9709c149cb3cdc28825ba28fb7ed">status</a> = &amp;p_BT1;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_SD1]-&gt;<a class="code hl_variable" href="structinput__t.html#aa46e9709c149cb3cdc28825ba28fb7ed">status</a> = &amp;p_BT2;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_POT1]-&gt;<a class="code hl_variable" href="structinput__t.html#aa46e9709c149cb3cdc28825ba28fb7ed">status</a> = &amp;pot1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// register output to be updated on input change</span></div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_BD0]-&gt;<a class="code hl_variable" href="structinput__t.html#a7a312dba32cd784ba2673747b24cd24c">update</a> = &amp;<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_BD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a>;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_SD1]-&gt;<a class="code hl_variable" href="structinput__t.html#a7a312dba32cd784ba2673747b24cd24c">update</a> = &amp;<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_SD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a>;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a310d04440c58dd0d664c62a891518a9c">input_ids</a>[I_POT1]-&gt;<a class="code hl_variable" href="structinput__t.html#a7a312dba32cd784ba2673747b24cd24c">update</a> = &amp;<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_POT1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// register outputa</span></div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB0]-&gt;<a class="code hl_variable" href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">status</a> = &amp;pic.pins[32].oavalue;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB1]-&gt;<a class="code hl_variable" href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">status</a> = &amp;pic.pins[33].oavalue;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">status</a> = &amp;pic.pins[18].oavalue;</div>
<div class="line">    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#a394c193a9f75a821997918c3fe8525a5">status</a> = &amp;pic.pins[19].oavalue;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Called ever 1s to refresh status</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a1492d042e89665dba3924b193f5bf9cc">cboard_x::RefreshStatus</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">// verify serial port state and refresh status bar</span></div>
<div class="line"><span class="preprocessor">#ifndef _WIN_</span></div>
<div class="line">    <span class="keywordflow">if</span> (pic.serial[0].serialfd &gt; 0)</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordflow">if</span> (pic.serial[0].serialfd != INVALID_HANDLE_VALUE)</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        PICSimLab.GetStatusBar()-&gt;SetField(2, lxT(<span class="stringliteral">&quot;Serial: &quot;</span>) + lxString::FromAscii(SERIALDEVICE) + lxT(<span class="stringliteral">&quot;:&quot;</span>) +</div>
<div class="line">                                                  itoa(pic.serial[0].serialbaud) + lxT(<span class="stringliteral">&quot;(&quot;</span>) +</div>
<div class="line">                                                  lxString().Format(<span class="stringliteral">&quot;%4.1f&quot;</span>, fabs((100.0 * pic.serial[0].serialexbaud -</div>
<div class="line">                                                                                   100.0 * pic.serial[0].serialbaud) /</div>
<div class="line">                                                                                  pic.serial[0].serialexbaud)) +</div>
<div class="line">                                                  lxT(<span class="stringliteral">&quot;%)&quot;</span>));</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        PICSimLab.GetStatusBar()-&gt;SetField(2, lxT(<span class="stringliteral">&quot;Serial: &quot;</span>) + lxString::FromAscii(SERIALDEVICE) + lxT(<span class="stringliteral">&quot; (ERROR)&quot;</span>));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Called to save board preferences in configuration file</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a5603baefc099825eeb53634ece32b2f8">cboard_x::WritePreferences</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">// write selected microcontroller of board_x to preferences</span></div>
<div class="line">    PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#aa34fc994a2b560032d8fbcfdea16a8c6">SavePrefs</a>(lxT(<span class="stringliteral">&quot;X_proc&quot;</span>), <a class="code hl_variable" href="classboard.html#a92f1e7588769e3cbc7cc0667c1bf3b8c">Proc</a>);</div>
<div class="line">    <span class="comment">// write switch state of board_x to preferences</span></div>
<div class="line">    PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#aa34fc994a2b560032d8fbcfdea16a8c6">SavePrefs</a>(lxT(<span class="stringliteral">&quot;X_bt2&quot;</span>), lxString().Format(<span class="stringliteral">&quot;%i&quot;</span>, p_BT2));</div>
<div class="line">    <span class="comment">// write microcontroller clock to preferences</span></div>
<div class="line">    PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#aa34fc994a2b560032d8fbcfdea16a8c6">SavePrefs</a>(lxT(<span class="stringliteral">&quot;X_clock&quot;</span>), lxString().Format(<span class="stringliteral">&quot;%2.1f&quot;</span>, PICSimLab.GetClock()));</div>
<div class="line">    <span class="comment">// write potentiometer position to preferences</span></div>
<div class="line">    PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#aa34fc994a2b560032d8fbcfdea16a8c6">SavePrefs</a>(lxT(<span class="stringliteral">&quot;X_pot1&quot;</span>), lxString().Format(<span class="stringliteral">&quot;%i&quot;</span>, pot1));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Called whe configuration file load  preferences</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a696180daddb7dfc9b5bf5ad45fca0124">cboard_x::ReadPreferences</a>(<span class="keywordtype">char</span>* name, <span class="keywordtype">char</span>* value) {</div>
<div class="line">    <span class="comment">// read switch state of board_x of preferences</span></div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;X_bt2&quot;</span>)) {</div>
<div class="line">        <span class="keywordflow">if</span> (value[0] == <span class="charliteral">&#39;0&#39;</span>)</div>
<div class="line">            p_BT2 = 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            p_BT2 = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// read microcontroller of preferences</span></div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;X_proc&quot;</span>)) {</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a92f1e7588769e3cbc7cc0667c1bf3b8c">Proc</a> = value;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// read microcontroller clock</span></div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;X_clock&quot;</span>)) {</div>
<div class="line">        PICSimLab.SetClock(atof(value));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// read potentiometer position</span></div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;X_pot1&quot;</span>)) {</div>
<div class="line">        pot1 = atoi(value);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event on the board</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a3db74c02199e114e22f7a7a5b4e3dd96">cboard_x::EvKeyPress</a>(uint key, uint mask) {</div>
<div class="line">    <span class="comment">// if keyboard key 1 is pressed then activate button (state=0)</span></div>
<div class="line">    <span class="keywordflow">if</span> (key == <span class="charliteral">&#39;1&#39;</span>) {</div>
<div class="line">        p_BT1 = 0;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_BD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// if keyboard key 2 is pressed then toggle switch state</span></div>
<div class="line">    <span class="keywordflow">if</span> (key == <span class="charliteral">&#39;2&#39;</span>) {</div>
<div class="line">        p_BT2 ^= 1;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_SD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event on the board</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#aef95af41c7e6c527dfe9e522912a19a2">cboard_x::EvKeyRelease</a>(uint key, uint mask) {</div>
<div class="line">    <span class="comment">// if keyboard key 1 is pressed then deactivate button (state=1)</span></div>
<div class="line">    <span class="keywordflow">if</span> (key == <span class="charliteral">&#39;1&#39;</span>) {</div>
<div class="line">        p_BT1 = 1;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_BD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event on the board</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a54f0b84ecd3973bdd3f7d8b7d13cc0b9">cboard_x::EvMouseButtonPress</a>(uint button, uint x, uint y, uint state) {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// search for the input area which owner the event</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variable" href="classboard.html#ad9f8dc51eeea817a22d9ffec01c1f0c2">inputc</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x1 &lt;= x) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x2 &gt;= x)) &amp;&amp; ((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y1 &lt;= y) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y2 &gt;= y))) {</div>
<div class="line">            <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].<span class="keywordtype">id</span>) {</div>
<div class="line">                    <span class="comment">// if event is over I_ISCP area then load hex file</span></div>
<div class="line">                <span class="keywordflow">case</span> I_ICSP:</div>
<div class="line">                    PICSimLab.OpenLoadHexFileDialog();</div>
<div class="line">                    ;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="comment">// if event is over I_PWR area then toggle board on/off</span></div>
<div class="line">                <span class="keywordflow">case</span> I_PWR:</div>
<div class="line">                    <span class="keywordflow">if</span> (PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#abe7b589c0de06036c5b167e815af9498">GetMcuPwr</a>())  <span class="comment">// if on turn off</span></div>
<div class="line">                    {</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a9c6f3626c3818890de8b8d8f758cdca6">SetMcuPwr</a>(0);</div>
<div class="line">                        <a class="code hl_function" href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">Reset</a>();</div>
<div class="line">                        p_BT1 = 1;</div>
<div class="line">                    } <span class="keywordflow">else</span>  <span class="comment">// if off turn on</span></div>
<div class="line">                    {</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a9c6f3626c3818890de8b8d8f758cdca6">SetMcuPwr</a>(1);</div>
<div class="line">                        <a class="code hl_function" href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">Reset</a>();</div>
<div class="line">                    }</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LPWR]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="comment">// if event is over I_RST area then turn off and reset</span></div>
<div class="line">                <span class="keywordflow">case</span> I_RST:</div>
<div class="line">                    <span class="keywordflow">if</span> (PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#abe7b589c0de06036c5b167e815af9498">GetMcuPwr</a>() &amp;&amp; pic_reset(&amp;pic, -1))  <span class="comment">// if powered</span></div>
<div class="line">                    {</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a9c6f3626c3818890de8b8d8f758cdca6">SetMcuPwr</a>(0);</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a077c76d5582e27431d8dceda7ff08d2f">SetMcuRst</a>(1);</div>
<div class="line">                    }</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a7a851447b6b05b5f600cb587aae0c778">p_RST</a> = 0;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RST]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="comment">// if event is over I_D0 area then activate button (state=0)</span></div>
<div class="line">                <span class="keywordflow">case</span> I_BD0:</div>
<div class="line">                    p_BT1 = 0;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_BD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="comment">// if event is over I_D1 area then toggle switch state</span></div>
<div class="line">                <span class="keywordflow">case</span> I_SD1:</div>
<div class="line">                    p_BT2 ^= 1;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_SD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> I_POT1: {</div>
<div class="line">                    active = 1;</div>
<div class="line">                    pot1 = (x - <a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].<a class="code hl_variable" href="structinput__t.html#a1e2b92740c7fb766fb0e6a672b9bb498">x1</a>) * 2.77;</div>
<div class="line">                    <span class="keywordflow">if</span> (pot1 &gt; 199)</div>
<div class="line">                        pot1 = 199;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_POT1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                } <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event on the board</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#acfd3a83c6a0ece11eb8d88dd9fa102f9">cboard_x::EvMouseMove</a>(uint button, uint x, uint y, uint state) {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variable" href="classboard.html#ad9f8dc51eeea817a22d9ffec01c1f0c2">inputc</a>; i++) {</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].<span class="keywordtype">id</span>) {</div>
<div class="line">            <span class="keywordflow">case</span> I_POT1:</div>
<div class="line">                <span class="keywordflow">if</span> (((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x1 &lt;= x) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x2 &gt;= x)) &amp;&amp; ((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y1 &lt;= y) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y2 &gt;= y))) {</div>
<div class="line">                    <span class="keywordflow">if</span> (active) {</div>
<div class="line">                        pot1 = (x - <a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].<a class="code hl_variable" href="structinput__t.html#a1e2b92740c7fb766fb0e6a672b9bb498">x1</a>) * 2.77;</div>
<div class="line">                        <span class="keywordflow">if</span> (pot1 &gt; 199)</div>
<div class="line">                            pot1 = 199;</div>
<div class="line">                        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_POT1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    active = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event on the board</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#abb94877b3a91eb371b3b20e2e9cebcce">cboard_x::EvMouseButtonRelease</a>(uint button, uint x, uint y, uint state) {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// search for the input area which owner the event</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variable" href="classboard.html#ad9f8dc51eeea817a22d9ffec01c1f0c2">inputc</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x1 &lt;= x) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].x2 &gt;= x)) &amp;&amp; ((<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y1 &lt;= y) &amp;&amp; (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].y2 &gt;= y))) {</div>
<div class="line">            <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classboard.html#a637392ea82a18ee9f9716147455031dd">input</a>[i].<span class="keywordtype">id</span>) {</div>
<div class="line">                    <span class="comment">// if event is over I_RST area then turn on</span></div>
<div class="line">                <span class="keywordflow">case</span> I_RST:</div>
<div class="line">                    <span class="keywordflow">if</span> (PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a17031743eb40a15b9ed14272f6187f18">GetMcuRst</a>())  <span class="comment">// if powered</span></div>
<div class="line">                    {</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a9c6f3626c3818890de8b8d8f758cdca6">SetMcuPwr</a>(1);</div>
<div class="line">                        PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#a077c76d5582e27431d8dceda7ff08d2f">SetMcuRst</a>(0);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (pic_reset(&amp;pic, -1)) {</div>
<div class="line">                            <a class="code hl_function" href="classcboard__x.html#a6f87b4f00b9297a5893a805820c4a436">Reset</a>();</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a7a851447b6b05b5f600cb587aae0c778">p_RST</a> = 1;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RST]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="comment">// if event is over I_D0 area then deactivate button (state=1)</span></div>
<div class="line">                <span class="keywordflow">case</span> I_BD0:</div>
<div class="line">                    p_BT1 = 1;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_BD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> I_POT1: {</div>
<div class="line">                    active = 0;</div>
<div class="line">                    <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_POT1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">                } <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Called ever 100ms to draw board</span></div>
<div class="line"><span class="comment">// This is the critical code for simulator running speed</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a18ebbd336dc27b64c0fdcc6a5d580ee4">cboard_x::Draw</a>(CDraw* draw) {</div>
<div class="line">    <span class="keywordtype">int</span> update = 0;  <span class="comment">// verifiy if updated is needed</span></div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// board_x draw</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variable" href="classboard.html#a52d4e88ddf5f29d1648ea94dafbf87de">outputc</a>; i++)  <span class="comment">// run over all outputs</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].update)  <span class="comment">// only if need update</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!update) {</div>
<div class="line">                draw-&gt;Canvas.Init(Scale, Scale);</div>
<div class="line">            }</div>
<div class="line">            update++;  <span class="comment">// set to update buffer</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].r)  <span class="comment">// if output shape is a rectangle</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span> == O_SD1)  <span class="comment">// if output is switch</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// draw a background white rectangle</span></div>
<div class="line">                    draw-&gt;Canvas.SetBgColor(255, 255, 255);</div>
<div class="line">                    draw-&gt;Canvas.Rectangle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1,</div>
<div class="line">                                           <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (!p_BT2)  <span class="comment">// draw switch off</span></div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// draw a grey rectangle</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(70, 70, 70);</div>
<div class="line">                        draw-&gt;Canvas.Rectangle(</div>
<div class="line">                            1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1 + ((<span class="keywordtype">int</span>)((<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1) * 0.35)),</div>
<div class="line">                            <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, (<span class="keywordtype">int</span>)((<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1) * 0.65));</div>
<div class="line">                    } <span class="keywordflow">else</span>  <span class="comment">// draw switch on</span></div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// draw a grey rectangle</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(70, 70, 70);</div>
<div class="line">                        draw-&gt;Canvas.Rectangle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1,</div>
<div class="line">                                               (<span class="keywordtype">int</span>)((<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1) * 0.65));</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span> == O_BD0) {</div>
<div class="line">                    draw-&gt;Canvas.SetColor(102, 102, 102);</div>
<div class="line">                    draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cx, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cy, 10);</div>
<div class="line">                    <span class="keywordflow">if</span> (p_BT1) {</div>
<div class="line">                        draw-&gt;Canvas.SetColor(15, 15, 15);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        draw-&gt;Canvas.SetColor(55, 55, 55);</div>
<div class="line">                    }</div>
<div class="line">                    draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cx, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cy, 8);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span> == O_RST) {</div>
<div class="line">                    draw-&gt;Canvas.SetColor(102, 102, 102);</div>
<div class="line">                    draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cx, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cy, 10);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a7a851447b6b05b5f600cb587aae0c778">p_RST</a>) {</div>
<div class="line">                        draw-&gt;Canvas.SetColor(15, 15, 15);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        draw-&gt;Canvas.SetColor(55, 55, 55);</div>
<div class="line">                    }</div>
<div class="line">                    draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cx, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].cy, 8);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span> == O_POT1) {</div>
<div class="line">                    draw-&gt;Canvas.SetColor(0, 50, 215);</div>
<div class="line">                    draw-&gt;Canvas.Rectangle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1,</div>
<div class="line">                                           <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1);</div>
<div class="line">                    draw-&gt;Canvas.SetColor(250, 250, 250);</div>
<div class="line">                    draw-&gt;Canvas.Rectangle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1 + pot1 / 2.77, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1 + 2, 10, 15);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span> == O_CPU) {</div>
<div class="line">                    draw-&gt;Canvas.SetFont(font);</div>
<div class="line">                    <span class="keywordtype">int</span> x, y, w, h;</div>
<div class="line">                    draw-&gt;Canvas.SetColor(26, 26, 26);</div>
<div class="line">                    draw-&gt;Canvas.Rectangle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1,</div>
<div class="line">                                           <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y2 - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1);</div>
<div class="line"> </div>
<div class="line">                    draw-&gt;Canvas.SetColor(230, 230, 230);</div>
<div class="line">                    w = <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a62355ce1deb5d7a3a7955b5bb25ac26c">x2</a> - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">x1</a>;</div>
<div class="line">                    h = <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#aabca51d7095f7ba0b654cbcfea9cd6b7">y2</a> - <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#aabca51d7095f7ba0b654cbcfea9cd6b7">y2</a>;</div>
<div class="line">                    x = <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a4a26c232a33f2387180a8bc0b6c078e7">x1</a> + (w / 2) + 7;</div>
<div class="line">                    y = <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<a class="code hl_variable" href="structoutput__t.html#a3ea90d25dafd4e3f279f3f541a956ffa">y1</a> + (h / 2) + (<a class="code hl_variable" href="classboard.html#a92f1e7588769e3cbc7cc0667c1bf3b8c">Proc</a>.length());</div>
<div class="line">                    draw-&gt;Canvas.RotatedText(<a class="code hl_variable" href="classboard.html#a92f1e7588769e3cbc7cc0667c1bf3b8c">Proc</a>, x, y, 270);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span>  <span class="comment">// if output shape is a circle</span></div>
<div class="line">            {</div>
<div class="line">                draw-&gt;Canvas.SetFgColor(0, 0, 0);  <span class="comment">// black</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].<span class="keywordtype">id</span>)  <span class="comment">// search for color of output</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">case</span> O_LD0:  <span class="comment">// White using pin 19 mean value (RD0)</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(pic.pins[18].oavalue, pic.pins[18].oavalue, pic.pins[18].oavalue);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="keywordflow">case</span> O_LD1:  <span class="comment">// Yelllow using pin 20 mean value (RD1)</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(pic.pins[19].oavalue, pic.pins[19].oavalue, 0);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="keywordflow">case</span> O_LPWR:  <span class="comment">// Blue using mcupwr value</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(0, 0, 200 * PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#abe7b589c0de06036c5b167e815af9498">GetMcuPwr</a>() + 55);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="keywordflow">case</span> O_RB0:  <span class="comment">// Green using pin 33 mean value (RB0)</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(0, pic.pins[32].oavalue, 0);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    <span class="keywordflow">case</span> O_RB1:  <span class="comment">// Red using pin 34 mean value (RB1)</span></div>
<div class="line">                        draw-&gt;Canvas.SetBgColor(pic.pins[33].oavalue, 0, 0);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// draw a LED</span></div>
<div class="line">                color1 = draw-&gt;Canvas.GetBgColor();</div>
<div class="line">                <span class="keywordtype">int</span> r = color1.Red() - 120;</div>
<div class="line">                <span class="keywordtype">int</span> g = color1.Green() - 120;</div>
<div class="line">                <span class="keywordtype">int</span> b = color1.Blue() - 120;</div>
<div class="line">                <span class="keywordflow">if</span> (r &lt; 0)</div>
<div class="line">                    r = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (g &lt; 0)</div>
<div class="line">                    g = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (b &lt; 0)</div>
<div class="line">                    b = 0;</div>
<div class="line">                color2.Set(r, g, b);</div>
<div class="line">                draw-&gt;Canvas.SetBgColor(color2);</div>
<div class="line">                draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].r + 1);</div>
<div class="line">                draw-&gt;Canvas.SetBgColor(color1);</div>
<div class="line">                draw-&gt;Canvas.Circle(1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].x1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].y1, <a class="code hl_variable" href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">output</a>[i].r - 2);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// end draw</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (update) {</div>
<div class="line">        draw-&gt;Canvas.End();</div>
<div class="line">        draw-&gt;Update();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// RB0 mean value to gauge1</span></div>
<div class="line">    gauge1-&gt;SetValue((pic.pins[33].oavalue - 55) / 2);</div>
<div class="line">    <span class="comment">// RB1 mean value to gauge2</span></div>
<div class="line">    gauge2-&gt;SetValue((pic.pins[32].oavalue - 55) / 2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classcboard__x.html#a6337aae979579d9d180026dfcd2c55c0">cboard_x::Run_CPU</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">int</span> j;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pi;</div>
<div class="line">    <span class="keyword">const</span> picpin* pins;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> alm[40];</div>
<div class="line">    <span class="keywordtype">int</span> bret;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> JUMPSTEPS = PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#ae7593e716065463586ba688d1d39d3c4">GetJUMPSTEPS</a>();  <span class="comment">// number of steps skipped</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> NSTEP = PICSimLab.GetNSTEP();     <span class="comment">// number of steps in 100ms</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> RNSTEP = 200.0 * pic.PINCOUNT / NSTEP;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// reset pins mean value</span></div>
<div class="line">    memset(alm, 0, 40 * <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// read pic.pins to a local variable to speed up</span></div>
<div class="line">    pins = pic.pins;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Spare parts window pre process</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#ac41e7f65ae979416dd133853774e206e">use_spare</a>)</div>
<div class="line">        SpareParts.<a class="code hl_function" href="class_c_spare_parts.html#aeb04eb62a248ea4f07e83d8752baf96f">PreProcess</a>();</div>
<div class="line"> </div>
<div class="line">    SWBounce_prepare(&amp;bounce, PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#aeae1956b61d48261081fc1b2bf339017">GetBoard</a>()-&gt;<a class="code hl_function" href="classboard.html#a2c5a0def304361ca54f770b2cd9520fd">MGetInstClockFreq</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_BT1_ = p_BT1;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_BT2_ = p_BT2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((pins[19 - 1].dir == PD_IN) &amp;&amp; (pins[19 - 1].value != p_BT1_)) {</div>
<div class="line">        SWBounce_bounce(&amp;bounce, 0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ((pins[20 - 1].dir == PD_IN) &amp;&amp; (pins[20 - 1].value != p_BT2_)) {</div>
<div class="line">        SWBounce_bounce(&amp;bounce, 1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    j = JUMPSTEPS;  <span class="comment">// step counter</span></div>
<div class="line">    pi = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (PICSimLab.<a class="code hl_function" href="class_c_p_i_c_sim_lab.html#abe7b589c0de06036c5b167e815af9498">GetMcuPwr</a>())       <span class="comment">// if powered</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NSTEP; i++)  <span class="comment">// repeat for number of steps in 100ms</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (j &gt;= JUMPSTEPS)  <span class="comment">// if number of step is bigger than steps to skip</span></div>
<div class="line">            {</div>
<div class="line">                pic_set_pin(&amp;pic, pic.mclr, <a class="code hl_variable" href="classboard.html#a7a851447b6b05b5f600cb587aae0c778">p_RST</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (!bounce.do_bounce) {</div>
<div class="line">                    pic_set_pin(&amp;pic, 19, p_BT1_);  <span class="comment">// Set pin 19 (RD0) with button state</span></div>
<div class="line">                    pic_set_pin(&amp;pic, 20, p_BT2_);  <span class="comment">// Set pin 20 (RD1) with switch state</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (bounce.do_bounce) {</div>
<div class="line">                bret = SWBounce_process(&amp;bounce);</div>
<div class="line">                <span class="keywordflow">if</span> (bret) {</div>
<div class="line">                    <span class="keywordflow">if</span> (bounce.bounce[0]) {</div>
<div class="line">                        <span class="keywordflow">if</span> (bret == 1) {</div>
<div class="line">                            pic_set_pin(&amp;pic, 19, !pins[19 - 1].value);</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            pic_set_pin(&amp;pic, 19, p_BT1_);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (bounce.bounce[1]) {</div>
<div class="line">                        <span class="keywordflow">if</span> (bret == 1) {</div>
<div class="line">                            pic_set_pin(&amp;pic, 20, !pins[20 - 1].value);</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            pic_set_pin(&amp;pic, 20, p_BT2_);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// verify if a breakpoint is reached if not run one instruction</span></div>
<div class="line">            <span class="keywordflow">if</span> (!mplabxd_testbp())</div>
<div class="line">                pic_step(&amp;pic);</div>
<div class="line">            ioupdated = pic.ioupdated;</div>
<div class="line">            <a class="code hl_function" href="classboard.html#a4baf2e6e854e2c46eac9104b82ed4d66">InstCounterInc</a>();</div>
<div class="line">            <span class="comment">// Oscilloscope window process</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a1f5dedbf50d1ebd86af96429a4a3d180">use_oscope</a>)</div>
<div class="line">                Oscilloscope.<a class="code hl_function" href="class_c_oscilloscope.html#a4455bcb15a36ee7a8f2e8a6c2befea9e">SetSample</a>();</div>
<div class="line">            <span class="comment">// Spare parts window process</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#ac41e7f65ae979416dd133853774e206e">use_spare</a>)</div>
<div class="line">                SpareParts.<a class="code hl_function" href="class_c_spare_parts.html#a3c9d0706b999f36f96de45530f097724">Process</a>();</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// increment mean value counter if pin is high</span></div>
<div class="line">            alm[pi] += pins[pi].value;</div>
<div class="line">            pi++;</div>
<div class="line">            <span class="keywordflow">if</span> (pi == pic.PINCOUNT)</div>
<div class="line">                pi = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (j &gt;= JUMPSTEPS)  <span class="comment">// if number of step is bigger than steps to skip</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// set analog pin 2 (AN0) with value from scroll</span></div>
<div class="line">                pic_set_apin(&amp;pic, 2, (5.0 * pot1 / 199));</div>
<div class="line"> </div>
<div class="line">                j = -1;  <span class="comment">// reset counter</span></div>
<div class="line">            }</div>
<div class="line">            j++;  <span class="comment">// counter increment</span></div>
<div class="line">            pic.ioupdated = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// calculate mean value</span></div>
<div class="line">    <span class="keywordflow">for</span> (pi = 0; pi &lt; pic.PINCOUNT; pi++) {</div>
<div class="line">        pic.pins[pi].oavalue = (int)((alm[pi] * RNSTEP) + 55);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Spare parts window pre post process</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#ac41e7f65ae979416dd133853774e206e">use_spare</a>)</div>
<div class="line">        SpareParts.<a class="code hl_function" href="class_c_spare_parts.html#adf2184d88f05dfb8d880c2c08473d0b8">PostProcess</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// verifiy if LEDS need update</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD0]-&gt;value != pic.pins[18].oavalue) {</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">value</a> = pic.pins[18].oavalue;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD1]-&gt;value != pic.pins[19].oavalue) {</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">value</a> = pic.pins[19].oavalue;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_LD1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB0]-&gt;value != pic.pins[32].oavalue) {</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB0]-&gt;<a class="code hl_variable" href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">value</a> = pic.pins[32].oavalue;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB0]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB1]-&gt;value != pic.pins[33].oavalue) {</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB1]-&gt;<a class="code hl_variable" href="structoutput__t.html#a23bc69196fed4d0e4924453a11e182bd">value</a> = pic.pins[33].oavalue;</div>
<div class="line">        <a class="code hl_variable" href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">output_ids</a>[O_RB1]-&gt;<a class="code hl_variable" href="structoutput__t.html#aa91b1205a6823abba2269f91bb87863d">update</a> = 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Register the board in PICSimLab</span></div>
<div class="line">board_init(BOARD_x_Name, <a class="code hl_class" href="classcboard__x.html">cboard_x</a>);</div>
<div class="ttc" id="aclass_c_oscilloscope_html_a4455bcb15a36ee7a8f2e8a6c2befea9e"><div class="ttname"><a href="class_c_oscilloscope.html#a4455bcb15a36ee7a8f2e8a6c2befea9e">COscilloscope::SetSample</a></div><div class="ttdeci">void SetSample(void)</div><div class="ttdoc">Sample and update oscilloscope data aquisition.</div><div class="ttdef"><b>Definition:</b> oscilloscope.cc:63</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_a077c76d5582e27431d8dceda7ff08d2f"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#a077c76d5582e27431d8dceda7ff08d2f">CPICSimLab::SetMcuRst</a></div><div class="ttdeci">void SetMcuRst(int pr)</div><div class="ttdoc">Set mcu rst flag (inform simulator about mcu reset state)</div><div class="ttdef"><b>Definition:</b> picsimlab.h:127</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_a17031743eb40a15b9ed14272f6187f18"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#a17031743eb40a15b9ed14272f6187f18">CPICSimLab::GetMcuRst</a></div><div class="ttdeci">int GetMcuRst(void)</div><div class="ttdoc">Retunr if microcontroller reset pin is enabled.</div><div class="ttdef"><b>Definition:</b> picsimlab.h:107</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_a9c6f3626c3818890de8b8d8f758cdca6"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#a9c6f3626c3818890de8b8d8f758cdca6">CPICSimLab::SetMcuPwr</a></div><div class="ttdeci">void SetMcuPwr(int pp)</div><div class="ttdoc">Set the power status of microcontroller ON/OFF.</div><div class="ttdef"><b>Definition:</b> picsimlab.h:114</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_aa34fc994a2b560032d8fbcfdea16a8c6"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#aa34fc994a2b560032d8fbcfdea16a8c6">CPICSimLab::SavePrefs</a></div><div class="ttdeci">void SavePrefs(lxString name, lxString value)</div><div class="ttdoc">Save the preferences.</div><div class="ttdef"><b>Definition:</b> picsimlab.cc:263</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_abe7b589c0de06036c5b167e815af9498"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#abe7b589c0de06036c5b167e815af9498">CPICSimLab::GetMcuPwr</a></div><div class="ttdeci">int GetMcuPwr(void)</div><div class="ttdoc">Return actual power status of microcontroller ON/OFF.</div><div class="ttdef"><b>Definition:</b> picsimlab.h:102</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_ae7593e716065463586ba688d1d39d3c4"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#ae7593e716065463586ba688d1d39d3c4">CPICSimLab::GetJUMPSTEPS</a></div><div class="ttdeci">int GetJUMPSTEPS(void)</div><div class="ttdoc">Get the number of steps to be skipped in board update.</div><div class="ttdef"><b>Definition:</b> picsimlab.h:87</div></div>
<div class="ttc" id="aclass_c_p_i_c_sim_lab_html_aeae1956b61d48261081fc1b2bf339017"><div class="ttname"><a href="class_c_p_i_c_sim_lab.html#aeae1956b61d48261081fc1b2bf339017">CPICSimLab::GetBoard</a></div><div class="ttdeci">board * GetBoard(void)</div><div class="ttdoc">Return a pointer to board object.</div><div class="ttdef"><b>Definition:</b> picsimlab.h:93</div></div>
<div class="ttc" id="aclass_c_spare_parts_html_a3c9d0706b999f36f96de45530f097724"><div class="ttname"><a href="class_c_spare_parts.html#a3c9d0706b999f36f96de45530f097724">CSpareParts::Process</a></div><div class="ttdeci">void Process(void)</div><div class="ttdoc">Execute the process code of spare parts N times (where N is the number of steps in 100ms)</div><div class="ttdef"><b>Definition:</b> spareparts.cc:546</div></div>
<div class="ttc" id="aclass_c_spare_parts_html_adf2184d88f05dfb8d880c2c08473d0b8"><div class="ttname"><a href="class_c_spare_parts.html#adf2184d88f05dfb8d880c2c08473d0b8">CSpareParts::PostProcess</a></div><div class="ttdeci">void PostProcess(void)</div><div class="ttdoc">Execute the post process code of spare parts one time per 100ms.</div><div class="ttdef"><b>Definition:</b> spareparts.cc:566</div></div>
<div class="ttc" id="aclass_c_spare_parts_html_aeb04eb62a248ea4f07e83d8752baf96f"><div class="ttname"><a href="class_c_spare_parts.html#aeb04eb62a248ea4f07e83d8752baf96f">CSpareParts::PreProcess</a></div><div class="ttdeci">void PreProcess(void)</div><div class="ttdoc">Execute the pre process code of spare parts one time per 100ms.</div><div class="ttdef"><b>Definition:</b> spareparts.cc:521</div></div>
<div class="ttc" id="aclassboard_html_a1f5dedbf50d1ebd86af96429a4a3d180"><div class="ttname"><a href="classboard.html#a1f5dedbf50d1ebd86af96429a4a3d180">board::use_oscope</a></div><div class="ttdeci">int use_oscope</div><div class="ttdoc">use oscilloscope window</div><div class="ttdef"><b>Definition:</b> board.h:624</div></div>
<div class="ttc" id="aclassboard_html_a2c5a0def304361ca54f770b2cd9520fd"><div class="ttname"><a href="classboard.html#a2c5a0def304361ca54f770b2cd9520fd">board::MGetInstClockFreq</a></div><div class="ttdeci">virtual float MGetInstClockFreq(void)=0</div><div class="ttdoc">board microcontroller get cpu internal clock (in PIC frequency/4)</div></div>
<div class="ttc" id="aclassboard_html_a310d04440c58dd0d664c62a891518a9c"><div class="ttname"><a href="classboard.html#a310d04440c58dd0d664c62a891518a9c">board::input_ids</a></div><div class="ttdeci">input_t * input_ids[120]</div><div class="ttdoc">input map elements by id order</div><div class="ttdef"><b>Definition:</b> board.h:619</div></div>
<div class="ttc" id="aclassboard_html_a4baf2e6e854e2c46eac9104b82ed4d66"><div class="ttname"><a href="classboard.html#a4baf2e6e854e2c46eac9104b82ed4d66">board::InstCounterInc</a></div><div class="ttdeci">void InstCounterInc(void)</div><div class="ttdoc">Increment the Intructions Counter.</div><div class="ttdef"><b>Definition:</b> board.cc:368</div></div>
<div class="ttc" id="aclassboard_html_a52d4e88ddf5f29d1648ea94dafbf87de"><div class="ttname"><a href="classboard.html#a52d4e88ddf5f29d1648ea94dafbf87de">board::outputc</a></div><div class="ttdeci">int outputc</div><div class="ttdoc">output map elements counter</div><div class="ttdef"><b>Definition:</b> board.h:623</div></div>
<div class="ttc" id="aclassboard_html_a637392ea82a18ee9f9716147455031dd"><div class="ttname"><a href="classboard.html#a637392ea82a18ee9f9716147455031dd">board::input</a></div><div class="ttdeci">input_t input[120]</div><div class="ttdoc">input map elements</div><div class="ttdef"><b>Definition:</b> board.h:618</div></div>
<div class="ttc" id="aclassboard_html_a7a851447b6b05b5f600cb587aae0c778"><div class="ttname"><a href="classboard.html#a7a851447b6b05b5f600cb587aae0c778">board::p_RST</a></div><div class="ttdeci">unsigned char p_RST</div><div class="ttdoc">board /RESET pin state</div><div class="ttdef"><b>Definition:</b> board.h:626</div></div>
<div class="ttc" id="aclassboard_html_a92f1e7588769e3cbc7cc0667c1bf3b8c"><div class="ttname"><a href="classboard.html#a92f1e7588769e3cbc7cc0667c1bf3b8c">board::Proc</a></div><div class="ttdeci">lxString Proc</div><div class="ttdoc">Name of processor in use.</div><div class="ttdef"><b>Definition:</b> board.h:616</div></div>
<div class="ttc" id="aclassboard_html_a94afe9318a9cd0d8635d0043424a8682"><div class="ttname"><a href="classboard.html#a94afe9318a9cd0d8635d0043424a8682">board::output_ids</a></div><div class="ttdeci">output_t * output_ids[120]</div><div class="ttdoc">output map elements by id order</div><div class="ttdef"><b>Definition:</b> board.h:621</div></div>
<div class="ttc" id="aclassboard_html_abb9694f4430944f5f6e110c3af6feb3e"><div class="ttname"><a href="classboard.html#abb9694f4430944f5f6e110c3af6feb3e">board::output</a></div><div class="ttdeci">output_t output[120]</div><div class="ttdoc">output map elements</div><div class="ttdef"><b>Definition:</b> board.h:620</div></div>
<div class="ttc" id="aclassboard_html_ac41e7f65ae979416dd133853774e206e"><div class="ttname"><a href="classboard.html#ac41e7f65ae979416dd133853774e206e">board::use_spare</a></div><div class="ttdeci">int use_spare</div><div class="ttdoc">use spare parts window</div><div class="ttdef"><b>Definition:</b> board.h:625</div></div>
<div class="ttc" id="aclassboard_html_ad9f8dc51eeea817a22d9ffec01c1f0c2"><div class="ttname"><a href="classboard.html#ad9f8dc51eeea817a22d9ffec01c1f0c2">board::inputc</a></div><div class="ttdeci">int inputc</div><div class="ttdoc">input map elements counter</div><div class="ttdef"><b>Definition:</b> board.h:622</div></div>
<div class="ttc" id="astructinput__t_html_a1e2b92740c7fb766fb0e6a672b9bb498"><div class="ttname"><a href="structinput__t.html#a1e2b92740c7fb766fb0e6a672b9bb498">input_t::x1</a></div><div class="ttdeci">unsigned int x1</div><div class="ttdoc">x1 position</div><div class="ttdef"><b>Definition:</b> board.h:44</div></div>
<div class="ttc" id="astructinput__t_html_a7a312dba32cd784ba2673747b24cd24c"><div class="ttname"><a href="structinput__t.html#a7a312dba32cd784ba2673747b24cd24c">input_t::update</a></div><div class="ttdeci">unsigned char * update</div><div class="ttdoc">output need draw update</div><div class="ttdef"><b>Definition:</b> board.h:53</div></div>
<div class="ttc" id="astructinput__t_html_aa46e9709c149cb3cdc28825ba28fb7ed"><div class="ttname"><a href="structinput__t.html#aa46e9709c149cb3cdc28825ba28fb7ed">input_t::status</a></div><div class="ttdeci">void * status</div><div class="ttdoc">rcontrol status</div><div class="ttdef"><b>Definition:</b> board.h:52</div></div>
<div class="ttc" id="astructoutput__t_html_a62355ce1deb5d7a3a7955b5bb25ac26c"><div class="ttname"><a href="structoutput__t.html#a62355ce1deb5d7a3a7955b5bb25ac26c">output_t::x2</a></div><div class="ttdeci">unsigned int x2</div><div class="ttdoc">x2 position</div><div class="ttdef"><b>Definition:</b> board.h:67</div></div>
<div class="ttc" id="astructoutput__t_html_aabca51d7095f7ba0b654cbcfea9cd6b7"><div class="ttname"><a href="structoutput__t.html#aabca51d7095f7ba0b654cbcfea9cd6b7">output_t::y2</a></div><div class="ttdeci">unsigned int y2</div><div class="ttdoc">y2 position</div><div class="ttdef"><b>Definition:</b> board.h:69</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
